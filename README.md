# OpenClash Rule Generator Configuration

Коротко: набор конфигураций и правил для OpenClash, который автоматически исключает указанные регионы из проксинга и выбирает оптимальные узлы по ping для остального трафика.

## Что делает этот репозиторий

- Исключает трафик из заданных стран (например, Россия, Китай, Иран и т.д.) — такой трафик идёт напрямую (DIRECT).
- Автовыбор лучший узел (url-test) для остального трафика по минимальной задержке.
- Фильтрует и исключает просроченные/невалидные серверы по ремаркам в подписке.
- Готовые примеры правил и шаблон конфигурации для subconverter / OpenClash.

## Быстрый старт

1. Скачайте конфиг (замените USER и REPO на свои значения):
```bash
wget https://raw.githubusercontent.com/YOUR_USERNAME/YOUR_REPO/main/openclash-config.ini -O openclash-config.ini
```

2. Преобразование подписки через subconverter:
```
https://api.subconverter.com/sub?target=clash&url=YOUR_SUBSCRIPTION_URL&config=https://raw.githubusercontent.com/YOUR_USERNAME/YOUR_REPO/main/openclash-config.ini
```

3. Установка в OpenClash:
- Откройте OpenClash Web UI → Config Manage → Config Update
- Вставьте ссылку из subconverter в поле Config URL → Update Config

## Основные концепции и примеры

- exclude_remarks — регулярная строка/список ключевых слов, по которым серверы будут исключаться (например, русские ремарки, CN, HK, TW, IR, expired и т.д.)
- Главная группа прокси: "节点选择" (select) — содержит опции: Автовыбор (url-test), DIRECT, все узлы.
- Автовыбор: "♻️ 自动选择" (url-test) — тестирует узлы по URL (например, http://www.gstatic.com/generate_204) и выбирает с минимальным ping.

Пример exclude_remarks:
```ini
exclude_remarks=(俄罗斯|Russia|RU|Moscow|Москва|中国|China|CN|HK|香港|TW|台湾|IR|Iran|Tehran|expired|到期)
```

Пример группы url-test (с базовыми параметрами):
```ini
proxy_group=♻️ 自动选择, url-test, http://www.gstatic.com/generate_204, 300, 50
```

Параметры примера:
- Интервал теста: 300s (5 минут)
- Топ N кандидатов: 50

## Рекомендуемые параметры
- OpenClash версии: v0.45.0+
- Интервал url-test: 300–600 сек (меньше — быстрее реагирует, больше — стабильнее)
- Таймаут выбора: 30–100 ms (в зависимости от требований к скорости/стабильности)

## Кастомизация
- Добавьте/удалите ключевые слова в exclude_remarks, чтобы скорректировать список исключений.
- Измените интервал и таймаут в группе url-test в зависимости от вашей сети.
- При необходимости можно добавить статические правила (DOMAIN-SUFFIX, IP-CIDR и т.д.) в начало конфигурац��и.

Пример статического правила:
```ini
rules:
- DOMAIN-SUFFIX,example-local-service.com,DIRECT
- DOMAIN-SUFFIX,blocked-service.com,节点选择
```

## Автообновление
- Конфиг можно интегрировать с GitHub Actions / workflow для автоматической генерации и публикации обновлённого raw-конфига.
- Источники GeoIP/GeoSite и список antifilter могут обновляться отдельно — укажите ссылки на источники, если нужно включить их в workflow.

## Устранение проблем (коротко)
- Сервер не исключается: проверьте ремарки в подписке и расширьте exclude_remarks.
- Автовыбор выбирает медленные узлы: уменьшите таймаут или проверьте, не исключены ли быстрые узлы.
- Частые переключения: увеличьте interval url-test (например, до 600s) и/или увеличьте порог таймаута.

## Лицензия
MIT — свободное использование и модификация.

## Контрибуция
Открыты issues и pull requests. Пожалуйста, опишите проблему/идею и приложите пример конфигурации, если требуется.

---
Автор: amirjkhanat
Обновлено: 2025-09-24